class DomElement {
  constructor(tagId, cssClass, tagType, content, ...child) {
    this.tagId = tagId;
    this.cssClass = cssClass;
    this.tagType = tagType;
    this.content = content;
    this.child = child;
  }
  createDom() {
    this.domObject = document.createElement(this.tagType);
    this.domObject.classList.add(this.cssClass);
    this.domObject.id = this.tagId;
    this.domObject.innerHTML = this.content;
    if (this.child.length > 0) {
      this.child.forEach((element) => {
        console.log(element);
        this.domObject.appendChild(element);
      });
    }
    return this.domObject;
  }
}

(async function mainFunc() {
  // Google search keywords: javascript await foreach
  // Reference link: https://stackoverflow.com/questions/51738684/await-with-array-foreach-containing-async-await
  await Promise.all(
    houseIdList.map((elm) => {
      createDom(elm);
    }),
  );
})();

// Google search keywords: get json with async
// Reference link: https://dmitripavlutin.com/javascript-fetch-async-await/
async function fetchData(url) {
  if (url != '') {
    const response = await fetch(url);
    const data = await response.json();
    return data;
  }
}

async function createDom(houseId) {
  // Google search keywords: javascript create dom
  // Reference link: https://www.javascripttutorial.net/dom/manipulating/create-a-dom-element/
  const houseDiv = new DomElement('', 'got-house', 'div', '');
  const houseTitleH1 = new DomElement('', 'got-house__title', 'h1', '');
  let currentLord = '';
  await fetchData('https://anapioficeandfire.com/api/houses/' + houseId).then(
    (data) => {
      data;
      houseTitleH1.content = data.name;
      currentLord = data.currentLord;
    },
  );
  houseDiv.child.push(houseTitleH1.createDom());
  const lordNameSpan = new DomElement(
    'lordOf_' + houseId,
    'got-house__current-lord',
    'span',
    '',
  );
  await fetchData(currentLord).then((data) => {
    data;
    if (data !== undefined) {
      lordNameSpan.content = data.name;
    } else {
      lordNameSpan.content = 'With out Lord Name';
    }
  });

  houseDiv.child.push(lordNameSpan.createDom());
  document.getElementById('got-house-list').appendChild(houseDiv.createDom());
}

// Button click event
document.getElementById('kill-random-lord-button').onclick = async () => {
  const rndHouseId =
    houseIdList[Math.floor(Math.random() * houseIdList.length)];
  let swornMembersArr = [];
  const houseNameStr = await fetchData(
    'https://anapioficeandfire.com/api/houses/' + rndHouseId,
  ).then((data) => {
    data;
    swornMembersArr = data.swornMembers;
  });
  const rndSwornMember =
    swornMembersArr[Math.floor(Math.random() * swornMembersArr.length)];
  console.log(rndSwornMember);
  const swornMemberStr = await fetchData(rndSwornMember).then((data) => {
    data;
    document.getElementById('lordOf_' + rndHouseId).innerHTML = data.name;
  });
};

// some good references:
// Google search keywords: JavaScript get json
// Reference link: https://stackoverflow.com/questions/12460378/how-to-get-json-from-url-in-javascript
